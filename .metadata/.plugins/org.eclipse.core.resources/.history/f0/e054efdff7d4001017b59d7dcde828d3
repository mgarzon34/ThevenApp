
package com.circuitos.analisiscircuitos.test;

import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import com.circuitos.analisiscircuitos.analisis.Analizador;
import com.circuitos.analisiscircuitos.analisis.ResultadoThevenin;
import com.circuitos.analisiscircuitos.dominio.*;

/**
 * Clase de pruebas unitarias para verificar el cálculo de Thevenin y Norton (JUnit 5).
 * 
 * @author Marco Antonio Garzón Palos
 * @version 1.0
 */
class TheveninTest {

	//Prueba con un simple divisor de tensión
    @Test
    @DisplayName("Test Divisor de Tensión Simple")
    void testDivisorTension() {
        Circuito circuito = new Circuito();
        circuito.addComponente(new FuenteTensionInd(10.0, 0, 2));
        circuito.addComponente(new Resistencia(1000.0, 2, 1));
        circuito.addComponente(new Resistencia(1000.0, 1, 0, true));
        circuito.addComponente(new Tierra(0));
        Analizador analizador = new Analizador();
        ResultadoThevenin resultado = analizador.calculaThevenin(circuito, 1, 0);
        
        assertEquals(5.0, resultado.getVth(), 0.001, "La tensión de Thevenin debe ser 5V");
        assertEquals(500.0, resultado.getRth(), 0.001, "La resistencia de Thevenin debe ser 500Ω");
    }

    //Prueba con circuito complejo 1
    @Test
    @DisplayName("Test Circuito Complejo 1")
    void testCircuitoLanzador1() {
        Circuito circuito = new Circuito();
		circuito.addComponente(new FuenteTensionInd(12, 0, 1));
		circuito.addComponente(new FuenteCorrienteInd("4m", 1, 2));
		circuito.addComponente(new Resistencia("3k", 0, 2));
		circuito.addComponente(new Resistencia("6k", 2, 3, true)); //Resistencia de carga
		circuito.addComponente(new Resistencia("4k", 0, 3));
		circuito.addComponente(new Resistencia("2k", 1, 3));
        circuito.addComponente(new Tierra(0));
        int nodoA = 2;
        int nodoB = 3;

        Analizador analizador = new Analizador();
        ResultadoThevenin resTh = analizador.calculaThevenin(circuito, nodoA, nodoB);
        assertEquals(10.0, resTh.getVth(), 0.01, "Vth debe ser 10V");
        assertEquals(2000.0, resTh.getRth(), 0.01, "Rth debe ser 2000Ω");
    }
    
    //Prueba con circuito complejo 3
    @Test
    @DisplayName("Test Circuito Complejo 3")
    void testCircuitoLanzador3() {
        Circuito circuito = new Circuito();
        circuito.addComponente(new Resistencia(4000, 0, 1));
        circuito.addComponente(new FuenteTensionInd(12, 1, 2));
        circuito.addComponente(new Resistencia(6000, 0, 2, true)); // Carga
        circuito.addComponente(new FuenteCorrienteInd(0.002, 2, 3)); 
        circuito.addComponente(new Resistencia(2000, 0, 3));
        circuito.addComponente(new Resistencia(2000, 1, 3));
        circuito.addComponente(new Tierra(0)); 
        int nodoA = 0;
        int nodoB = 2;

        Analizador analizador = new Analizador();
        ResultadoThevenin resTh = analizador.calculaThevenin(circuito, nodoA, nodoB);
        assertEquals(10.0, resTh.getVth(), 0.01, "Vth debe ser 10V");
        assertEquals(2000.0, resTh.getRth(), 0.01, "Rth debe ser 2000Ω");
    }
    
    //Prueba de validación de Tierra
    @Test
    @DisplayName("Test Validación de Tierra")
    void testFaltaTierraLanzaExcepcion() {
    	// Comprobamos que el sistema falla si no hay tierra
    	Circuito circuito = new Circuito();
    	circuito.addComponente(new Resistencia(100, 1, 2));
    	
    	Analizador analizador = new Analizador();
    	assertThrows(Exception.class, () -> {
    		analizador.calculaThevenin(circuito, 1, 2);
    	}, "Debe lanzar excepción si falta el nodo de referencia");
    }
}