package com.circuitos.AnalisisCircuitos.gui.commands;

import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.layout.Pane;

public class RemoveNodeCommand implements Command {
	private final Pane pane;
	private final Node node;
	private int oldIndex=-1;
	private boolean ejecutado=false;
	
	public RemoveNodeCommand(Node node, Pane pane) {
		this.node=node;
		this.pane=pane;
		
	}
	@Override
	public void ejecutar() {
		if(!esValido() || ejecutado) return;
		oldIndex=pane.getChildren().indexOf(node);
		if(oldIndex>=0)
			pane.getChildren().remove(node);
		ejecutado=true;
	}

	@Override
	public void deshacer() {
		if(!esValido() || !ejecutado) return;
		Parent parent=node.getParent();
		if(parent instanceof Pane p && p!=pane) {
			p.getChildren().remove(node);
		}
		int idx=(oldIndex<0) ? pane.getChildren().size()
				: clamp(oldIndex, 0, pane.getChildren().size());
		if(!pane.getChildren().contains(node)) {
			pane.getChildren().add(idx, node);
		}
		ejecutado=false;
	}

	@Override
	public String getDescripcion() {
		String id=(node!=null && node.getId()!=null) ? " "+node.getId() : "";
		return "Eliminar nodo intermedio"+id;
	}
	
	@Override
	public boolean esValido() {
		return pane!=null && node!=null;
	}
	
	@Override
	public boolean puedeFusionarCon(Command otro) {
		return false;
	}
	
	@Override
	public void fusionarCon(Command otro) { /* no aplica */ }
	
	/**
	 * Restringe un entero al intervalo [min, max]
	 */
	private static int clamp(int val, int min, int max) {
		if(val<min) return min;
		if(val>max) return max;
		return val;
	}
}
