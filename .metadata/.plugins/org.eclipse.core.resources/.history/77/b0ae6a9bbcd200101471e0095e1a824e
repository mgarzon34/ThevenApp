package com.circuitos.temporal.gui.builder;

import java.util.function.Supplier;

import com.circuitos.analisiscircuitos.dominio.Componente;
import com.circuitos.analisiscircuitos.dominio.FuenteCorrienteDependiente;
import com.circuitos.analisiscircuitos.dominio.FuenteCorrienteInd;
import com.circuitos.analisiscircuitos.dominio.FuenteDependiente;
import com.circuitos.analisiscircuitos.dominio.FuenteTensionDependiente;
import com.circuitos.analisiscircuitos.dominio.FuenteTensionInd;
import com.circuitos.analisiscircuitos.dominio.Resistencia;
import com.circuitos.analisiscircuitos.dominio.Tierra;

/**
 * Enum que representa los tipos de componentes visuales con su icono, 
 * dimensiones gráficas y constructor de dominio. 
 * Se usa en {@link ComponenteFactory} y {@link ComponenteVisualFactory} para crear los objetos.
 * 
 * @author Marco Antonio Garzon Palos
 * @version 1.0
 */
public enum TipoComponenteVisual {

	RESISTOR("resistor.png", 140, 60, 0, 135, () -> new Resistencia(1.0, -1, -2)),
	TIERRA("tierra.png", 60, 90, 90, 48, () -> new Tierra(-1)),
	FTI("fti.png", 90, 110, 90, 90, () -> new FuenteTensionInd(0.0, -1, -2)),
	FCI("fci.png", 90, 110, 90, 90, () -> new FuenteCorrienteInd(0.0, -1, -2)),
	FTD("ftd.png", 90, 110, 90, 90, () -> new FuenteTensionDependiente(1.0, -1, -2,
			FuenteDependiente.ControlType.TENSION, -1, -2)),
	FCD("fcd.png", 90, 110, 90, 90, () -> new FuenteCorrienteDependiente(1.0, -1, -2,
			FuenteDependiente.ControlType.TENSION, -1, -2));
	
	private final String icono;
	private final double anchoPanel;
	private final double altoPanel;
	private final int defaultOrientationAngle;
	private final double anchoIcono;
	private final Supplier<Componente> constructor;
	
	/**
	 * Constructor del TipoComponenteVisual. Crea, tanto el objeto de dominio como
	 * su interfaz visual.
	 * 
	 * @param icono						Icono del componente (imagen)
	 * @param anchoPanel				Ancho del panel que lo incluye
	 * @param altoPanel					Alto del panel que lo incluye
	 * @param anchoIcono				Ancho del icono
	 * @param constructor				Constructor del objeto de dominio
	 */
	TipoComponenteVisual(String icono, double anchoPanel, double altoPanel,
						int defaultOrientationAngle,
						double anchoIcono, Supplier<Componente> constructor) {
		this.icono=icono;
		this.anchoPanel=anchoPanel;
		this.altoPanel=altoPanel;
		this.defaultOrientationAngle=defaultOrientationAngle;
		this.anchoIcono=anchoIcono;
		this.constructor=constructor;
	}
	
	/**
	 * Obtiene el icono del componente.
	 * 
	 * @return icono 			Icono del componente
	 */
	public String getIcono() {
		return icono;
	}
	
	/**
	 * Obtiene el ancho del panel que contiene al componente.
	 * 
	 * @return anchoPanel		Ancho del panel que contiene al componente
	 */
	public double getAnchoPanel() {
		return anchoPanel;
	}
	
	/**
	 * Obtiene el alto del panel que contiene al componente.
	 * 
	 * @return altoPanel		Alto del panel que contiene al componente
	 */
	public double getAltoPanel() {
		return altoPanel;
	}
	
	/**
	 * Devuelve el ángulo base al que nace el componente:
	 * 0º si es horizontal por defecto, 90º si es vertical.
	 * 
	 * @return Ángúlo por defecto
	 */
	public int getDefaultOrientationAngle() {
		return defaultOrientationAngle;
	}
	
	/**
	 * Obtiene el ancho del icono del componente.
	 * 
	 * @return anchoIcono		Ancho del icono del componente
	 */
	public double getAnchoIcono() {
		return anchoIcono;
	}
	
	/**
	 * Crea un objeto Componente a partir del constructor.
	 * 
	 * @return comp				Objeto de tipo Componente
	 */
	public Componente crearComponente() {
		return constructor.get();
	}
	
	/**
	 * Obtiene el tipo de componente desde el nombre del icono.
	 * 
	 * @param icono 			Nombre del icono
	 * @return tipo				TipoComponenteVisual correspondiente al icono
	 * @throws IllegalArgumentException si el icono no es reconocido
	 */
	public static TipoComponenteVisual fromIcono(String icono) {
		for(TipoComponenteVisual tipo : values()) {
			if(tipo.icono.equals(icono)) return tipo;
		}
		throw new IllegalArgumentException("Icono desconocido: "+icono);
	}
	
	/**
	 * Obtiene el tipo visual a partir de un componente del dominio.
	 * 
	 * @param c				Componente del que obtenemos el tipo visual
	 * @return tipo			TipoComponenteVisual que le corresponde
	 * @throws IllegalArgumentException si el tipo no es reconocido
	 */
	public static TipoComponenteVisual fromComponente(Componente c) {
		if(c instanceof Resistencia) return RESISTOR;
		if(c instanceof FuenteTensionInd) return FTI;
		if(c instanceof FuenteCorrienteInd) return FCI;
		if(c instanceof FuenteTensionDependiente) return FTD;
		if(c instanceof FuenteCorrienteDependiente) return FCD;
		if(c instanceof Tierra) return TIERRA;
		throw new IllegalArgumentException("Componente no reconocido: "+c.getClass());
	}
}
